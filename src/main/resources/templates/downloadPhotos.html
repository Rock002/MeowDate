<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/base}">
<head>
    <title>–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</title>

    <th:block layout:fragment="styles">
        <style>
            .upload-container {
                max-width: 600px;
                margin: 0 auto;
                padding: 2rem;
                background: white;
                border-radius: 10px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            }

            .upload-area {
                border: 2px dashed #667eea;
                border-radius: 10px;
                padding: 3rem;
                text-align: center;
                margin-bottom: 2rem;
                cursor: pointer;
                transition: all 0.3s;
            }

            .upload-area:hover {
                background-color: rgba(102, 126, 234, 0.05);
            }

            .upload-icon {
                font-size: 3rem;
                color: #667eea;
                margin-bottom: 1rem;
            }

            .file-list {
                margin-top: 1rem;
            }

            .file-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.5rem;
                background: #f8f9fa;
                border-radius: 5px;
                margin-bottom: 0.5rem;
            }

            .file-name {
                flex-grow: 1;
                margin: 0 1rem;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            .preview-container {
                display: flex;
                flex-wrap: wrap;
                gap: 1rem;
                margin-top: 2rem;
            }

            .preview-item {
                width: 150px;
                height: 150px;
                border-radius: 8px;
                overflow: hidden;
                position: relative;
            }

            .preview-item img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

            .remove-btn {
                position: absolute;
                top: 5px;
                right: 5px;
                background: rgba(255, 71, 87, 0.9);
                color: white;
                border: none;
                border-radius: 50%;
                width: 25px;
                height: 25px;
                cursor: pointer;
            }

            .instructions {
                background: #e3f2fd;
                border-left: 4px solid #2196f3;
                padding: 1rem;
                margin-bottom: 2rem;
                border-radius: 4px;
            }
        </style>
    </th:block>
</head>
<body>
<th:block layout:fragment="content">
    <div class="upload-container">
        <h1 class="text-center mb-4">üì∏ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</h1>

        <div class="instructions">
            <h5>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</h5>
            <ul class="mb-0">
                <li>–ü–µ—Ä–≤–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è —Å—Ç–∞–Ω–µ—Ç –≤–∞—à–µ–π –≥–ª–∞–≤–Ω–æ–π (–∞–≤–∞—Ç–∞—Ä–∫–æ–π)</li>
                <li>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: –Ω–µ –º–µ–Ω–µ–µ 500x500 –ø–∏–∫—Å–µ–ª–µ–π</li>
                <li>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: JPG, PNG, GIF</li>
                <li>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 5MB</li>
            </ul>
        </div>

        <form action="/photos/postDownload" method="post" enctype="multipart/form-data" id="uploadForm">
            <!-- –§–∞–π–ª 1 (–≥–ª–∞–≤–Ω–∞—è) -->
            <div class="mb-4">
                <label class="form-label fw-bold">
                    1. –ì–ª–∞–≤–Ω–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è (–∞–≤–∞—Ç–∞—Ä) *
                    <span class="badge bg-primary ms-2">–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</span>
                </label>
                <div class="upload-area" onclick="document.getElementById('firstPhoto').click()">
                    <div class="upload-icon">üì∑</div>
                    <p>–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞</p>
                    <small class="text-muted">–ü–µ—Ä–≤–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∫–∞–∫ –≤–∞—à–∞ –≥–ª–∞–≤–Ω–∞—è</small>
                </div>
                <input type="file" class="form-control d-none" id="firstPhoto" name="firstPhoto"
                       accept="image/*" required onchange="previewFile(this, 0)">
                <div class="file-list" id="fileList1"></div>
            </div>

            <!-- –§–∞–π–ª 2 -->
            <div class="mb-4">
                <label class="form-label fw-bold">
                    2. –í—Ç–æ—Ä–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è
                    <span class="badge bg-secondary ms-2">–ü–æ –∂–µ–ª–∞–Ω–∏—é</span>
                </label>
                <div class="upload-area" onclick="document.getElementById('secondPhoto').click()">
                    <div class="upload-icon">üñºÔ∏è</div>
                    <p>–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞</p>
                </div>
                <input type="file" class="form-control d-none" id="secondPhoto" name="secondPhoto"
                       accept="image/*" onchange="previewFile(this, 1)">
                <div class="file-list" id="fileList2"></div>
            </div>

            <!-- –§–∞–π–ª 3 -->
            <div class="mb-4">
                <label class="form-label fw-bold">
                    3. –¢—Ä–µ—Ç—å—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è
                    <span class="badge bg-secondary ms-2">–ü–æ –∂–µ–ª–∞–Ω–∏—é</span>
                </label>
                <div class="upload-area" onclick="document.getElementById('thirdPhoto').click()">
                    <div class="upload-icon">üé®</div>
                    <p>–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞</p>
                </div>
                <input type="file" class="form-control d-none" id="thirdPhoto" name="thirdPhoto"
                       accept="image/*" onchange="previewFile(this, 2)">
                <div class="file-list" id="fileList3"></div>
            </div>

            <!-- –ü—Ä–µ–≤—å—é -->
            <div class="preview-container" id="previewContainer"></div>

            <!-- –ö–Ω–æ–ø–∫–∏ -->
            <div class="d-grid gap-2 mt-4">
                <button type="submit" class="btn btn-primary btn-lg">
                    üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
                </button>
                <a th:href="@{/profile}" class="btn btn-outline-secondary">
                    ‚Üê –ù–∞–∑–∞–¥ –≤ –ø—Ä–æ—Ñ–∏–ª—å
                </a>
            </div>
        </form>
    </div>
</th:block>

<th:block layout:fragment="scripts">
    <script>
        const previews = [null, null, null];

        function previewFile(input, index) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                previews[index] = e.target.result;
                updatePreview(index, file.name);
            };
            reader.readAsDataURL(file);
        }

        function updatePreview(index, fileName) {
            const fileList = document.getElementById(`fileList${index + 1}`);
            fileList.innerHTML = `
                <div class="file-item">
                    <span>üìÑ</span>
                    <span class="file-name">${fileName}</span>
                    <button type="button" class="btn btn-sm btn-outline-danger"
                            onclick="removeFile(${index})">‚úï</button>
                </div>
            `;

            renderPreviews();
        }

        function removeFile(index) {
            const input = document.getElementById([`firstPhoto`, `secondPhoto`, `thirdPhoto`][index]);
            input.value = '';
            previews[index] = null;

            const fileList = document.getElementById(`fileList${index + 1}`);
            fileList.innerHTML = '';

            renderPreviews();
        }

        function renderPreviews() {
            const container = document.getElementById('previewContainer');
            container.innerHTML = '';

            previews.forEach((preview, index) => {
                if (preview) {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'preview-item';
                    previewItem.innerHTML = `
                        <img src="${preview}" alt="Preview ${index + 1}">
                        <button type="button" class="remove-btn" onclick="removeFile(${index})">‚úï</button>
                    `;
                    container.appendChild(previewItem);
                }
            });
        }

        // Drag and drop
        document.querySelectorAll('.upload-area').forEach(area => {
            area.addEventListener('dragover', e => {
                e.preventDefault();
                area.style.backgroundColor = 'rgba(102, 126, 234, 0.1)';
            });

            area.addEventListener('dragleave', () => {
                area.style.backgroundColor = '';
            });

            area.addEventListener('drop', e => {
                e.preventDefault();
                area.style.backgroundColor = '';

                const file = e.dataTransfer.files[0];
                if (file && file.type.startsWith('image/')) {
                    const input = area.nextElementSibling;
                    const dataTransfer = new DataTransfer();
                    dataTransfer.items.add(file);
                    input.files = dataTransfer.files;

                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–Ω–¥–µ–∫—Å
                    const index = Array.from(document.querySelectorAll('.upload-area')).indexOf(area);
                    previewFile(input, index);
                }
            });
        });
    </script>
</th:block>
</body>
</html>