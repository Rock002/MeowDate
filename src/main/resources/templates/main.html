<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/base}">
<head>
    <title>–ê–Ω–∫–µ—Ç—ã</title>

    <th:block layout:fragment="styles">
        <style>
            .page-title {
                margin-bottom: 20px;
                font-size: 24px;
                color: #333;
            }

            .profiles-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                gap: 20px;
                margin-top: 20px;
            }

            .profile-card {
                background: white;
                border: 1px solid #e0e0e0;
                border-radius: 8px;
                overflow: hidden;
                transition: box-shadow 0.2s;
            }

            .profile-card:hover {
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            }

            .profile-photo {
                width: 100%;
                height: 300px;
                object-fit: cover;
                background: #f5f5f5;
            }

            .profile-info {
                padding: 15px;
            }

            .profile-name {
                font-size: 18px;
                font-weight: 500;
                margin-bottom: 5px;
            }

            .profile-details {
                color: #666;
                font-size: 14px;
                margin-bottom: 10px;
            }

            .profile-details span {
                display: inline-block;
                margin-right: 10px;
            }

            .profile-bio {
                color: #777;
                font-size: 14px;
                line-height: 1.4;
                margin: 10px 0;
            }

            .profile-actions {
                display: flex;
                gap: 10px;
                padding: 10px 15px 15px;
                border-top: 1px solid #eee;
            }

            .action-btn {
                flex: 1;
                padding: 8px 0;
                border: 1px solid #ddd;
                background: white;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
                transition: all 0.2s;
            }

            .like-btn {
                color: #e91e63;
                border-color: #e91e63;
            }

            .like-btn:hover {
                background: #e91e63;
                color: white;
            }

            .dislike-btn:hover {
                background: #f5f5f5;
            }

            .empty-state {
                text-align: center;
                padding: 60px 20px;
                color: #666;
            }

            .empty-icon {
                font-size: 48px;
                margin-bottom: 20px;
                opacity: 0.3;
            }
        </style>
    </th:block>
</head>
<body>
<th:block layout:fragment="content">
    <h1 class="page-title">–ê–Ω–∫–µ—Ç—ã</h1>

    <div th:if="${profiles != null && !profiles.isEmpty()}">
        <div class="profiles-grid">
            <div class="profile-card" th:each="profile : ${profiles}">
                <!-- –§–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                <div th:if="${profileFirstPhotoIds != null && profileFirstPhotoIds.containsKey(profile.id)}">
                    <img th:src="@{/{id}(id=${profileFirstPhotoIds.get(profile.id)})}"
                         alt="–§–æ—Ç–æ"
                         class="profile-photo">
                </div>
                <div th:unless="${profile.photos != null && !profile.photos.isEmpty()}">
                    <div class="profile-photo" style="display: flex; align-items: center; justify-content: center; font-size: 48px;">
                        üë§
                    </div>
                </div>

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div class="profile-info">
                    <div class="profile-name" th:text="${profile.username}"></div>

                    <div class="profile-details">
                            <span th:if="${profile.userProfile != null && profile.userProfile.sex != null}">
                                <span th:text="${profile.userProfile.sex}"></span>
                            </span>

                        <span th:if="${profile.userProfile != null && profile.userProfile.birthDate != null}">
                                <span th:text="${#temporals.year(#temporals.createNow()) - #temporals.year(profile.userProfile.birthDate)}"></span> –ª–µ—Ç
                            </span>

                        <span th:if="${profile.userProfile != null && profile.userProfile.location != null}">
                                üìç <span th:text="${profile.userProfile.location}"></span>
                            </span>
                    </div>

                    <div class="profile-bio" th:if="${profile.userProfile != null && profile.userProfile.info != null}"
                         th:text="${profile.userProfile.info}">
                    </div>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                <div class="profile-actions">
                    <button class="action-btn dislike-btn"
                            th:onclick="'dislikeProfile(' + ${profile.id} + ')'">
                        üëé –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å
                    </button>
                    <button class="action-btn like-btn"
                            th:onclick="'likeProfile(' + ${profile.id} + ')'">
                        ‚ù§Ô∏è –õ–∞–π–∫
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div th:unless="${profiles != null && !profiles.isEmpty()}" class="empty-state">
        <div class="empty-icon">üòø</div>
        <h3>–ü–æ–∫–∞ –Ω–µ—Ç –∞–Ω–∫–µ—Ç</h3>
        <p>–ü–æ–¥–æ–∂–¥–∏—Ç–µ, –ø–æ–∫–∞ –¥—Ä—É–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞–ø–æ–ª–Ω—è—Ç —Å–≤–æ–∏ –ø—Ä–æ—Ñ–∏–ª–∏.</p>
    </div>
</th:block>

<th:block layout:fragment="scripts">
    <script>
        function likeProfile(profileId) {
            fetch('/like/' + profileId, {
                method: 'POST'
            }).then(response => {
                if (response.ok) {
                    const card = document.querySelector(`[data-profile-id="${profileId}"]`);
                    if (card) {
                        card.style.opacity = '0.5';
                        setTimeout(() => card.remove(), 300);
                    }
                    showNotification('–õ–∞–π–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! ‚ù§Ô∏è');
                }
            });
        }

        function dislikeProfile(profileId) {
            const card = document.querySelector(`[data-profile-id="${profileId}"]`);
            if (card) {
                card.style.opacity = '0.5';
                setTimeout(() => card.remove(), 300);
            }
            showNotification('–ê–Ω–∫–µ—Ç–∞ –ø—Ä–æ–ø—É—â–µ–Ω–∞ üëé');
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #333;
                color: white;
                padding: 12px 20px;
                border-radius: 4px;
                z-index: 10000;
                font-size: 14px;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => notification.remove(), 3000);
        }
    </script>
</th:block>
</body>
</html>